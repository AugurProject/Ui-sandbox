<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8"/>
    <title>Sidebar Test</title>
    <link rel="stylesheet" href="./styles.css">
  </head>
  <body>
    <h1>Sidebar Test</h1>
    <div id="root"></div>
    <script src="https://unpkg.com/react@latest/dist/react.js"></script>
    <script src="https://unpkg.com/react-dom@latest/dist/react-dom.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
    <script type="text/babel">
      const data = {
        topics: ['finance', 'ethereum', 'sports', 'politics', 'science'],
        subTopics: {
          'finance': [ 'Trading', 'Forex', 'Crypto', 'USD', 'EUR' ],
          'ethereum': [ 'ICOs', 'ERC-20', 'Ether', 'GAS Prices', 'PoS' ],
          'sports': [ 'Football', 'Baseball', 'Soccer', 'Hockey', 'Tennis' ],
          'politics': [ 'Trump', 'Republicans', 'Democrats', 'Healthcare', 'SCOTUS' ],
          'science': [ 'Geology', 'Biology', 'Chemistry', 'Physics', 'Astrophysics']
        }
      };
      class SideBar extends React.Component {
        constructor(props) {
          super(props);
          this.state = {
            selectedTopic: props.data.topics[0],
            topicClass: 'topic-list',
            subTopicClass: 'sub-topic-list',
            sideBarClass: 'side-bar',
            isOpen: false,
            togglingSubMenu: false,
          };
          this.toggleSidebar = this.toggleSidebar.bind(this);
        }

        componentDidUpdate() {
          const s = this.state;
          const stl = this.subTopicList;
          if (s.togglingSubMenu) {
            stl.addEventListener('animationend', () => {
              this.setState({ togglingSubMenu: false, subTopicClass: 'sub-topic-list isOpen' });
            }, false);
          }
        }

        toggleSidebar() {
          if (!this.state.togglingSubMenu) {
            if (this.state.isOpen) {
              this.setState({ topicClass: 'topic-list', subTopicClass: 'sub-topic-list', sideBarClass: 'side-bar', isOpen: false, });
            } else {
              this.setState({ topicClass: 'topic-list isOpen', subTopicClass: 'sub-topic-list isOpen', sideBarClass: 'side-bar isOpen', isOpen: true, });
            }
          }
        }

        toggleSubTopics = topic => {
          this.setState({ selectedTopic: topic, subTopicClass: 'sub-topic-list slide' ,togglingSubMenu: true, animationLock: true });
        }

        render() {
          const p = this.props.data;
          const s = this.state;

          return (
              <article className="page-container">

                <aside ref={(ref) => this.sideBar = ref} className={s.sideBarClass}>
                    <div className='options-bar'>
                      <a className="button" onClick={this.toggleSidebar}>topics</a>
                    </div>
                    <ul ref={(ref) => this.topicList = ref} className={s.topicClass}>
                      {
                        p.topics.map(topic => {
                        return (<li key={topic}><a className="button" onClick={() => this.toggleSubTopics(topic)}>{topic}</a></li>)
                      })
                      }
                    </ul>
                    <ul ref={(ref) => this.subTopicList = ref} className={s.subTopicClass}>
                      {
                        p.subTopics[s.selectedTopic].map(subTopic => {
                        return (<li key={subTopic}>{subTopic}</li>)
                      })
                      }
                    </ul>
                </aside>
                <div ref="content" className='page-content'>
                  <p>Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content -- Markets Page Content</p>
                </div>
              </article>
          );
        }
      };
      ReactDOM.render(
          <SideBar data={data}/>,
        document.getElementById('root')
      );
    </script>
  </body>
</html>
