<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8"/>
  <title>CandleStick Chart</title>
  <script src="https://unpkg.com/react@latest/dist/react.js"></script>
  <script src="https://unpkg.com/react-dom@latest/dist/react-dom.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
  <script src="https://code.highcharts.com/stock/highstock.js"></script>
  <!--<script src="/Users/john/offline/react.js"></script>-->
  <!--<script src="/Users/john/offline/react-dom.js"></script>-->
  <!--<script src="/Users/john/offline/babel.min.js"></script>-->
  <!--<script src="/Users/john/offline/highstock.js"></script>-->
</head>
<body>
<div id="root"></div>
<script type="text/babel">
  // Data from: https://www.highcharts.com/samples/data/jsonp.php?a=e&filename=aapl-ohlc.json
  const orderBook = [
    [1417564800000, 115.75, 116.35, 115.11, 112.10, 2340],
    [1417651200000, 115.77, 117.20, 115.29, 115.49, 2340],
    [1417737600000, 115.99, 116.08, 114.64, 115.00, 2340],
    [1417996800000, 114.10, 114.65, 111.62, 112.40, 2340],
    [1418083200000, 110.19, 114.30, 109.35, 114.12, 2340],
    [1418169600000, 114.41, 114.85, 111.54, 111.95, 2340],
    [1418256000000, 112.26, 113.80, 111.34, 111.62, 2340],
    [1418342400000, 110.46, 111.87, 109.58, 109.73, 2340],
    [1418601600000, 110.70, 111.60, 106.35, 108.22, 2340],
    [1418688000000, 106.37, 110.16, 106.26, 106.74, 2340],
    [1418774400000, 107.12, 109.84, 106.82, 109.41, 2310],
    [1418860800000, 111.87, 112.65, 110.66, 112.65, 2320],
    [1418947200000, 112.26, 113.24, 111.66, 111.78, 2220],
    [1419206400000, 112.16, 113.49, 111.97, 112.94, 2340],
    [1419292800000, 113.23, 113.33, 112.46, 112.54, 23150],
    [1419379200000, 112.58, 112.71, 112.01, 112.01, 23610],
    [1419552000000, 112.10, 114.52, 112.01, 113.99, 1340],
    [1419811200000, 113.79, 114.77, 113.70, 113.91, 23430],
    [1419897600000, 113.64, 113.92, 112.11, 112.52, 26340],
    [1419984000000, 112.82, 113.13, 110.21, 110.38, 26340],
    [1420156800000, 111.39, 111.44, 107.35, 109.33, 1200],
    [1420416000000, 108.29, 108.65, 105.41, 106.25, 11200],
    [1420502400000, 106.54, 107.43, 104.63, 106.26, 100],
    [1420588800000, 107.20, 108.20, 106.70, 107.75, 200],
    [1420675200000, 109.23, 112.15, 108.70, 111.89, 3200],
    [1420761600000, 112.67, 113.25, 110.21, 112.01, 1200],
    [1421020800000, 112.60, 112.63, 108.80, 109.25, 12200],
    [1421107200000, 111.43, 112.80, 108.91, 110.22, 1200],
    [1421193600000, 109.04, 110.49, 108.50, 109.80, 12800],
    [1421280000000, 110.00, 110.06, 106.66, 106.82, 1200],
    [1421366400000, 107.03, 107.58, 105.20, 105.99, 23200],
    [1421712000000, 107.84, 108.97, 106.50, 108.72, 1200],
    [1421798400000, 108.95, 111.06, 108.27, 109.55, 1200],
    [1421884800000, 110.26, 112.47, 109.72, 112.40, 1200],
    [1421971200000, 112.30, 113.75, 111.53, 112.98, 1200],
    [1422230400000, 113.74, 114.36, 112.80, 113.10, 1200],
    [1422316800000, 112.42, 112.48, 109.03, 109.14, 12050],
    [1422403200000, 117.62, 118.12, 115.31, 115.31, 122300],
    [1422489600000, 116.32, 119.19, 115.56, 118.90, 1200],
    [1422576000000, 118.40, 120.00, 116.85, 117.16, 123200],
    [1429488000000, 125.57, 128.12, 125.17, 127.60, 33218],
    [1429574400000, 128.10, 128.20, 126.67, 126.91, 3218],
    [1429660800000, 126.99, 128.87, 126.32, 128.62, 36218],
    [1429747200000, 128.30, 130.42, 128.14, 129.67, 3218],
    [1429833600000, 130.49, 130.63, 129.23, 130.28, 37218],
    [1430092800000, 132.31, 133.13, 131.15, 132.65, 32318],
    [1430179200000, 134.46, 134.54, 129.57, 130.56, 32218],
    [1430265600000, 130.16, 131.59, 128.30, 128.64, 32818],
    [1430352000000, 128.64, 127.88, 124.58, 125.15, 3218]
  ];
  //  import noData from 'highcharts/modules/no-data-to-display';
  class CandleStickChart extends React.Component {
    constructor(props) {
      super(props);
      this.getVolumeFromOrderBook = this.getVolumeFromOrderBook.bind(this);
    }

    componentDidMount() {
//      noData(Highcharts); when back in augur UI repo
      this.candleStickChart = new Highcharts.stockChart('candlestick_chart', {
        chart: {
          backgroundColor: '#2d2846',
          borderWidth: 0,
          width: 700,
          height: 500,
          events: {
            load: function (event) {
              console.log(`hiding`);
            }
          }
        },
        rangeSelector: {
          enabled: false
        },
        buttonTheme: {
          visibility: 'hidden'
        },
        labelStyle: {
          visibility: 'hidden'
        },
        lang: {
          noData: 'No Chart Data',
        },
        borderWidth: 0,
        title: {
          text: 'Historical Data for \"Will the World End by December 31st, 2017\"'
        },
        plotOptions: {
          candlestick: {
            dataLabels: {
              enabled: false
            },
            shadow: false
          }
        },
        xAxis: {
          scrollbar: {
            enabled: false
          },
          shadow: false,
          borderWidth: 0
        },
        yAxis: [{
          labels: {
            align: 'left',
            x: -3
          },
          height: '100%',
          lineWidth: 2,
          tickLength: 20,
          gridLineColor: '#625e73',
          gridLineWidth: 2
        }, {
          // second y-axis: grey volume columns
          labels: {
            align: 'right'
          },
          top: '80%',
          height: '20%',
          offset: 0,
          lineWidth: 2,
          minorGridLineWidth: 0,
          gridLineWidth: 0,
          lineColor: 'transparent'
        }],
        series: [{
          type: 'candlestick',
          name: 'Pricing Data',
          maxPointWidth: 3,
          color: '#ef5134',
          lineColor: '#ef5134',
          upColor: '#67eec6',
          upLineColor: '#67eec6',
        }, {
          type: 'column',
          name: '',
          color: '#615d73',
          pointWidth: 4,
          yAxis: 1,
          gridLineWidth:0
        }]
      });

      this.updateChart();
    }

    componentDidUpdate(prevProps) {
      if (prevProps.orderBook !== this.props.orderBook) this.updateChart();
    }

    componentWillUnmount() {
      window.removeEventListener('resize', this.updateChart);
      this.chart.destroy();
    }

    getVolumeFromOrderBook(orderBook) {

      const volumeData = [];
      for (let i = 0; i < orderBook.length; i++) {
        const volumeForDate = [];
        volumeForDate.push(orderBook[i][0], orderBook[i][5]);
        volumeData.push(volumeForDate);
      }
      return volumeData;
    }

    updateChart() {
      this.candleStickChart.series[0].setData(this.props.orderBook, false);
      const volumeData = this.getVolumeFromOrderBook(this.props.orderBook);
      this.candleStickChart.series[1].setData(volumeData, false);
      this.candleStickChart.redraw();
    }

    render() {
      const p = this.props;

      return (
          <article
              className="order-book-chart"
          >
            <div
                id="candlestick_chart"
            />
          </article>
      );
    }
  }
  ReactDOM.render(
      <CandleStickChart orderBook={orderBook}/>,
    document.getElementById('root')
  );
</script>
</body>
</html>
